import os
import platform
import subprocess

def get_chrome_version():
    try:
        if platform.system() == "Windows":
            result = subprocess.run(['reg', 'query', r'HKEY_CURRENT_USER\Software\Google\Chrome\BLBeacon', '/v', 'version'], capture_output=True, text=True)
            version = result.stdout.split()[-1]
        elif platform.system() == "Darwin":
            result = subprocess.run(['/Applications/Google Chrome.app/Contents/MacOS/Google Chrome', '--version'], capture_output=True, text=True)
            version = result.stdout.split()[-1]
        else:  # Linux
            result = subprocess.run(['google-chrome', '--version'], capture_output=True, text=True)
            version = result.stdout.split()[-1]
        return version
    except Exception as e:
        return str(e)

def update_chrome():
    try:
        if platform.system() == "Windows":
            os.system('powershell -Command "Start-Process msiexec -ArgumentList \'/i https://dl.google.com/chrome/install/standalonesetup64.exe /quiet /norestart\' -Wait"')
        elif platform.system() == "Darwin":
            os.system('brew install --cask google-chrome')
        else:  # Linux
            os.system('sudo apt-get --only-upgrade install google-chrome-stable')
    except Exception as e:
        return str(e)
    return "Update initiated. Please restart Chrome to complete the installation."

def main():
    print("Checking Chrome version...")
    current_version = get_chrome_version()
    print(f"Current Chrome version: {current_version}")
    
    # Define the safe versions
    safe_version_windows_mac = '125.0.6422.112'
    safe_version_linux = '125.0.6422.112'
    
    # Check if current version is outdated
    if platform.system() == "Windows" or platform.system() == "Darwin":
        if current_version < safe_version_windows_mac:
            print("Chrome is outdated. Initiating update...")
            update_status = update_chrome()
            print(update_status)
        else:
            print("Chrome is up-to-date.")
    else:  # Linux
        if current_version < safe_version_linux:
            print("Chrome is outdated. Initiating update...")
            update_status = update_chrome()
            print(update_status)
        else:
            print("Chrome is up-to-date.")

if __name__ == "__main__":
    main()
